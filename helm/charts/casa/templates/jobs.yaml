  
apiVersion: batch/v1
kind: Job
metadata:
    name: {{ include "casa.fullname" . }}-cm-job
    labels:
        app: {{ include "casa.name" . }}-casacm
spec:
    template:
        metadata:
            name: {{ include "casa.name" . }}-casacm
            labels:
                app: {{ include "casa.name" . }}-casacm
        spec:
            containers:
                - name: {{ include "casa.name" . }}-casacm 
                  image: gcr.io/cloud-builders/kubectl:latest
                  command:
                    - sh
                    - -c 
                    - /scripts/casacm.sh 
                  volumeMounts:
                    - name: casacm-script 
                      mountPath: "/scripts/casacm.sh"
                      subPath: casacm.sh
            volumes:
                - name: casacm-script
                  configMap:
                    name: {{ include "casa.name" . }}-update-casacm
                    defaultMode: 0777
            restartPolicy: Never