apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "opendj.fullname" . }}
data:
  GLUU_CONFIG_ADAPTER: {{ .Values.global.configAdapterName | quote }}
  GLUU_SECRET_ADAPTER: {{ .Values.global.configSecretAdapter | quote }}
  GLUU_LDAP_INIT_HOST: {{ .Values.global.serviceName }} #{{ template "gluu.fullname" . }}-service
  GLUU_LDAP_INIT: {{ .Values.gluuLdapInit | quote }} # TODO: To be removed
  GLUU_LDAP_INIT_PORT: {{ .Values.gluuLdapInitPort | quote }}
  GLUU_OXTRUST_CONFIG_GENERATION: {{ .Values.gluuOxtrustConfigGeneration | quote }}
  {{- if and (.Values.gluuRedisEnabled) (eq .Values.gluuCacheType "REDIS") }}
  GLUU_CACHE_TYPE: {{ .Values.gluuRedisCacheType | quote }}
  GLUU_REDIS_URL: {{ .Values.gluuRedisUrl | quote }}
  GLUU_REDIS_TYPE: {{ .Values.gluuRedisType | quote }}
  {{- else }}
  GLUU_CACHE_TYPE: {{ .Values.gluuCacheType | quote }}
  {{- end }}
  # must the same as the opendj service name
  GLUU_CERT_ALT_NAME: {{ .Values.global.serviceName }} #{{ template "gluu.fullname" . }}-service

---

apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "opendj.fullname" . }}-persistence
data:
  GLUU_CONFIG_ADAPTER: {{ .Values.global.configAdapterName | quote }}
  GLUU_SECRET_ADAPTER: {{ .Values.global.configSecretAdapter | quote }}
  GLUU_PERSISTENCE_TYPE: {{ .Values.global.gluuPersistenceType | quote }}
  # options: default/user/site/cache/statistic used only if GLUU_PERSISTENCE_TYPE is hybrid
  {{- if eq .Values.global.gluuPersistenceType "hybrid" }}
  GLUU_PERSISTENCE_LDAP_MAPPING: {{ .Values.global.gluuPersistenceLdapMapping | quote }}
  {{- end }}
  {{- if or (eq .Values.global.gluuPersistenceType "ldap") (eq .Values.global.gluuPersistenceType "hybrid")  }}
  # used only if GLUU_PERSISTENCE_TYPE is ldap or hybrid
  GLUU_LDAP_URL: {{ .Values.global.gluuLdapUrl | quote }}
  {{- else if or (eq .Values.global.gluuPersistenceType "couchbase") (eq .Values.global.gluuPersistenceType "hybrid") }}
  #  used only if GLUU_PERSISTENCE_TYPE is couchbase or hybrid
  GLUU_COUCHBASE_URL: {{ .Values.global.gluuCouchBaseUrl }}
  GLUU_COUCHBASE_USER: {{ .Values.global.gluuCouchBaseUser }}
  GLUU_COUCHBASE_CERT_FILE: "/etc/certs/couchbase.crt"
  GLUU_COUCHBASE_PASSWORD_FILE: "/etc/gluu/conf/couchbase_password"
  {{- end }}
  